# やらなオカン - おかんAIからの電話でタスク管理

![IMAGE ALT TEXT HERE](./fig/thumbnail_1.png)

## 製品概要
### 背景(製品開発のきっかけ、課題等）
タスク管理アプリは数多く存在しますが、「入力が面倒」「通知を見逃す」「結局使わなくなる」という問題があります。特に、ToDoリストを開いて入力する行為自体がハードルとなり、タスク管理が続かない人が多くいます。

一方で、実家の「おかん」からの電話は、どんなに忙しくても出てしまうもの。そんな「おかんの電話」の力を活用し、AIが親しみやすい口調で電話をかけてきて、タスクの確認や進捗管理をしてくれるアプリを開発しました。

### 製品説明（具体的な製品の説明）
AI Callは、おかんを模したAIが電話をかけてきて、自然な会話を通じてタスク管理をサポートするアプリです。

朝や夕方など設定した時間に「おかんAI」から電話がかかってきて、「今日何するん？」「あれやった？」といった親しみやすい大阪弁の口調で、タスクの登録・確認・進捗管理を自然に行います。ユーザーは電話に出て話すだけで、タスクが自動的に管理され、記録として残ります。

#### 朝の電話（Morning Flow）
朝にかかってくる電話では、今日やるべきタスクを登録します：
1. **挨拶（INTRO）**：「おはよう！ちゃんと起きれたか？」と親しみやすく声をかける
2. **残タスク確認（REMAINING_TASKS）**：前日から持ち越したタスクがあれば「これ、今日ちゃんとやるんか？」とやや厳しめに確認
3. **今日のタスク入力（ASK_TODAY_TASKS）**：「ほな、今日は何やるつもりなんや？」とタスクを尋ねる
4. **タスク確認（CONFIRM_TODAY_TASKS）**：挙げられたタスクを箇条書きで確認し、「これで全部か？」と念押し
5. **締め（END）**：「ほな、今日もしっかり頑張りや！」と励まして終了

#### 夜の電話（Random Flow）
夕方や夜にかかってくる電話では、今日のタスク達成状況をチェックします：
1. **挨拶（INTRO）**：おかんが息子に声をかけるように「今日のタスクチェックするで」と伝える
2. **タスクループ（TASK_LOOP）**：登録された各タスクについて順番に
   - 初回：今日のタスク一覧を全部言い聞かせてから、最初のタスクができたか問いただす
   - 達成なら：しっかり褒めて次のタスクへ
   - 未達なら：責めずに「なんでや？」と理由を一言聞く
3. **持ち越し選択（CARRYOVER）**：未達のタスクから「明日やることを教えてや」と明日に回すものを選ばせる
4. **まとめ（SUMMARY）**：「できたこと」を再確認し、残タスクは「明日やったらええ」と励ます
5. **締め（END）**：「また明日な！」と温かく締めくくる

### 特長
#### 1. 2つの会話フローによる完全なタスク管理サイクル
朝の電話（Morning Flow）でタスクを登録し、夜の電話（Random Flow）で達成状況をチェック。AIは各ステップで適切なプロンプトに切り替わり、自然な会話の流れでタスク管理をサポートします。未達タスクは理由を聞いた上で翌日に自動的に持ち越され、継続的な管理が可能です。

#### 2. おかんキャラによる親しみやすく、逃げられない会話
AIは大阪弁を使う「おかん」のような親しみやすく、少し心配性で口うるさいキャラクター。命令口調ではなく、「大丈夫？」「なんでや？」「無理せんでええで」といった温かい言葉と適度なプレッシャーでタスク管理をサポート。電話という形式により、通知のように無視することができず、確実にタスクの確認タイミングを作ります。

#### 3. 会話ベースの自然なタスク入出力と自動保存
テキスト入力や複雑なUI操作は不要。話すだけでタスクが登録され、進捗が記録されます。Google Cloud Speech-to-Text / Text-to-Speechを活用し、高精度な音声認識・合成で自然な会話を実現。セッション管理により会話履歴とタスク状態はJSON形式で自動保存され、翌日以降も継続して管理できます。

### 解決出来ること
- **タスク管理が続かない問題**：電話という強制力と親しみやすい会話で、自然にタスク管理習慣が身につきます
- **通知を見逃してしまう問題**：電話という形式で確実にユーザーにリーチします
- **タスク入力が面倒な問題**：話すだけでタスクが登録され、進捗管理ができます
- **やる気が出ない問題**：おかんキャラの温かい励ましで、モチベーションを維持できます

### 今後の展望
- カレンダー連携機能によるスケジュール管理
- タスクの優先度自動判定機能
- 長期的なタスク達成率の可視化とフィードバック機能
- 家族や友人など、複数のキャラクター設定に対応
- リマインダー機能の強化（「あれ、やった？」と再確認）
- VoiceVoxなどのオープンソース音声合成エンジンの活用による多様なキャラクター音声対応

### 注力したこと（こだわり等）
* **2つの会話フローの設計**：朝のタスク登録（Morning Flow）と夜のタスクチェック（Random Flow）という2つの独立した会話フローを設計し、DialogueStepごとに適切なプロンプトを動的に切り替える仕組みを実装しました（`apps/server/chat/morning_flow.py`, `apps/server/chat/random_flow.py`）
* **おかんキャラクターの表現**：大阪弁を使用し、「お節介8割、共感2割」というキャラクター設定をシステムプロンプトに組み込み、親しみやすく逃げられない会話体験を実現しました
* **タスク状態の永続化**：current_task.mdを使った前日からのタスク持ち越し機能、未達タスクの理由記録、達成タスクの自動記録など、継続的なタスク管理を可能にする状態管理システムを構築しました
* **音声とテキストの統合**：音声認識・音声合成・GPT処理を1つのエンドポイントでシームレスに処理できるAPIを設計し、電話のような自然な会話体験を実現しました（`apps/server/voice_chat.py`）
* **セッション管理とログ機能**：ユーザーごとにセッションIDで会話を管理し、継続的な対話を可能にしました。また、会話内容は自動的にJSON形式で保存され、タスクの進捗を後から確認できるようにしました

## 開発技術
### 活用した技術
#### API・データ
* OpenRouter API（GPT-4o-mini）
* Google Cloud Speech-to-Text API
* Google Cloud Text-to-Speech API

#### フレームワーク・ライブラリ・モジュール
* FastAPI - バックエンドWebフレームワーク
* Uvicorn - ASGIサーバー
* httpx - HTTPクライアント
* python-dotenv - 環境変数管理
* python-multipart - マルチパートフォームデータ処理
* PyAudio - 音声入出力
* pynput - キーボード・マウス入力制御

#### デバイス
* macOS（開発・テスト環境）
* 将来的にiOS/Androidモバイルデバイス対応予定

### 独自技術
#### ハッカソンで開発した独自機能・技術
* 朝の会話フローエンジン（`apps/server/chat/morning_flow.py`）- 前日からの持ち越しタスク確認、今日のタスク登録、箇条書き形式での確認を行う朝専用の会話フローシステム
* 夜の会話フローエンジン（`apps/server/chat/random_flow.py`）- 各タスクの達成状況を1つずつ確認し、未達の場合は理由をヒアリングして翌日への持ち越しを管理する夜専用の会話フローシステム
* おかんキャラクターAI - 大阪弁を使用し、「お節介8割、共感2割」「やや厳しめだが励ましで締める」という独自のキャラクター性を持つ会話AIの設計とプロンプトエンジニアリング
* タスク状態管理システム（`db/current/current_task.md`）- 日をまたいだタスクの持ち越し、未達理由の記録、達成状況の追跡を行う永続化システム
* セッション管理機能（`apps/server/chat/gpt_chat.py`, `apps/server/chat/morning_chat.py`, `apps/server/chat/random_chat.py`）- ユーザーごとの会話履歴をJSON形式で保存し、継続的なタスク管理対話を実現
* 音声チャット統合API（`apps/server/morning_voice_chat.py`, `apps/server/random_voice_chat.py`）- 音声入力→テキスト変換→GPT処理→音声出力を1つのエンドポイントで処理する統合システム（電話のような自然な会話を実現）
